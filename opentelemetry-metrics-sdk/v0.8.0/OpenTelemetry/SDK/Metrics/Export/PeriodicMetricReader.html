<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader
  
    &mdash; OpenTelemetry
  
</title>

  <link rel="stylesheet" href="../../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader";
  relpath = '../../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../../OpenTelemetry.html" title="OpenTelemetry (module)">OpenTelemetry</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../SDK.html" title="OpenTelemetry::SDK (module)">SDK</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Metrics.html" title="OpenTelemetry::SDK::Metrics (module)">Metrics</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Export.html" title="OpenTelemetry::SDK::Metrics::Export (module)">Export</a></span></span>
     &raquo; 
    <span class="title">PeriodicMetricReader</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="MetricReader.html" title="OpenTelemetry::SDK::Metrics::Export::MetricReader (class)">MetricReader</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="MetricReader.html" title="OpenTelemetry::SDK::Metrics::Export::MetricReader (class)">MetricReader</a></span></li>
          
            <li class="next">OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/opentelemetry/sdk/metrics/export/periodic_metric_reader.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>PeriodicMetricReader provides a minimal example implementation.</p>


  </div>
</div>
<div class="tags">
  

</div>





  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="MetricReader.html" title="OpenTelemetry::SDK::Metrics::Export::MetricReader (class)">MetricReader</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="MetricReader.html#metric_store-instance_method" title="OpenTelemetry::SDK::Metrics::Export::MetricReader#metric_store (method)">#metric_store</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#after_fork-instance_method" title="#after_fork (instance method)">#<strong>after_fork</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#alive%3F-instance_method" title="#alive? (instance method)">#<strong>alive?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check both @thread and @continue object to determine if current PeriodicMetricReader is still alive.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#force_flush-instance_method" title="#force_flush (instance method)">#<strong>force_flush</strong>(timeout: nil)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Export all metrics to the configured <code>Exporter</code> that have not yet been exported.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(export_interval_millis: Float(ENV.fetch(&#39;OTEL_METRIC_EXPORT_INTERVAL&#39;, 60_000)), export_timeout_millis: Float(ENV.fetch(&#39;OTEL_METRIC_EXPORT_TIMEOUT&#39;, 30_000)), exporter: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a new instance of the <span class='object_link'><a href="" title="OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader (class)">PeriodicMetricReader</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">#<strong>shutdown</strong>(timeout: nil)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shuts the @thread down and set @continue to false; it will block until the shutdown thread is finished.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="MetricReader.html" title="OpenTelemetry::SDK::Metrics::Export::MetricReader (class)">MetricReader</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="MetricReader.html#collect-instance_method" title="OpenTelemetry::SDK::Metrics::Export::MetricReader#collect (method)">#collect</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(export_interval_millis: Float(ENV.fetch(&#39;OTEL_METRIC_EXPORT_INTERVAL&#39;, 60_000)), export_timeout_millis: Float(ENV.fetch(&#39;OTEL_METRIC_EXPORT_TIMEOUT&#39;, 30_000)), exporter: nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of the <span class='object_link'><a href="" title="OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader (class)">OpenTelemetry::SDK::Metrics::Export::PeriodicMetricReader</a></span>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>export_interval_millis</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Float(ENV.fetch(&#39;OTEL_METRIC_EXPORT_INTERVAL&#39;, 60_000))</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the maximum interval time. Defaults to the value of the OTEL_METRIC_EXPORT_INTERVAL environment variable, if set, or 60_000.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>export_timeout_millis</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Float(ENV.fetch(&#39;OTEL_METRIC_EXPORT_TIMEOUT&#39;, 30_000))</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the maximum export timeout. Defaults to the value of the OTEL_METRIC_EXPORT_TIMEOUT environment variable, if set, or 30_000.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exporter</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MetricReader.html" title="OpenTelemetry::SDK::Metrics::Export::MetricReader (class)">MetricReader</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the (duck type) MetricReader to where the recorded metrics are pushed after certain interval.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opentelemetry/sdk/metrics/export/periodic_metric_reader.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>export_interval_millis:</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'>ENV</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OTEL_METRIC_EXPORT_INTERVAL</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>60_000</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span>
               <span class='label'>export_timeout_millis:</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='const'>ENV</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OTEL_METRIC_EXPORT_TIMEOUT</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>30_000</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span>
               <span class='label'>exporter:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='rparen'>)</span>

  <span class='ivar'>@export_interval</span> <span class='op'>=</span> <span class='id identifier rubyid_export_interval_millis'>export_interval_millis</span> <span class='op'>/</span> <span class='float'>1000.0</span>
  <span class='ivar'>@export_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_export_timeout_millis'>export_timeout_millis</span> <span class='op'>/</span> <span class='float'>1000.0</span>
  <span class='ivar'>@exporter</span> <span class='op'>=</span> <span class='id identifier rubyid_exporter'>exporter</span>
  <span class='ivar'>@thread</span>   <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@continue</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@condition</span> <span class='op'>=</span> <span class='const'>ConditionVariable</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@export_mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_start'>start</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="after_fork-instance_method">
  
    #<strong>after_fork</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opentelemetry/sdk/metrics/export/periodic_metric_reader.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_after_fork'>after_fork</span>
  <span class='ivar'>@exporter</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span> <span class='kw'>if</span> <span class='ivar'>@exporter</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:reset</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_collect'>collect</span> <span class='comment'># move past previously reported metrics from parent process
</span>  <span class='ivar'>@thread</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_start'>start</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="alive?-instance_method">
  
    #<strong>alive?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check both @thread and @continue object to determine if current PeriodicMetricReader is still alive. If one of them is true/alive, then PeriodicMetricReader is determined as alive</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opentelemetry/sdk/metrics/export/periodic_metric_reader.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_alive?'>alive?</span>
  <span class='ivar'>@continue</span> <span class='op'>||</span> <span class='ivar'>@thread</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="force_flush-instance_method">
  
    #<strong>force_flush</strong>(timeout: nil)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Export all metrics to the configured <code>Exporter</code> that have not yet been exported.</p>

<p>This method should only be called in cases where it is absolutely necessary, such as when using some FaaS providers that may suspend the process after an invocation, but before the <code>PeriodicMetricReader</code> exports the completed metrics.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>optional Numeric</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>An optional timeout in seconds.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>SUCCESS if no error occurred, FAILURE if a non-specific failure occurred.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opentelemetry/sdk/metrics/export/periodic_metric_reader.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_force_flush'>force_flush</span><span class='lparen'>(</span><span class='label'>timeout:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_export'>export</span><span class='lparen'>(</span><span class='label'>timeout:</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../Export.html" title="OpenTelemetry::SDK::Metrics::Export (module)">Export</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Export.html#SUCCESS-constant" title="OpenTelemetry::SDK::Metrics::Export::SUCCESS (constant)">SUCCESS</a></span></span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span>
  <span class='const'><span class='object_link'><a href="../Export.html" title="OpenTelemetry::SDK::Metrics::Export (module)">Export</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Export.html#FAILURE-constant" title="OpenTelemetry::SDK::Metrics::Export::FAILURE (constant)">FAILURE</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shutdown-instance_method">
  
    #<strong>shutdown</strong>(timeout: nil)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shuts the @thread down and set @continue to false; it will block until the shutdown thread is finished.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>optional Numeric</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>An optional timeout in seconds.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>SUCCESS if no error occurred, FAILURE if a non-specific failure occurred.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opentelemetry/sdk/metrics/export/periodic_metric_reader.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown'>shutdown</span><span class='lparen'>(</span><span class='label'>timeout:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_thread'>thread</span> <span class='op'>=</span> <span class='id identifier rubyid_lock'>lock</span> <span class='kw'>do</span>
    <span class='ivar'>@continue</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='comment'># force termination in next iteration
</span>    <span class='ivar'>@condition</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
    <span class='ivar'>@thread</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_thread'>thread</span><span class='op'>&amp;.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@export_interval</span><span class='rparen'>)</span>
  <span class='ivar'>@exporter</span><span class='period'>.</span><span class='id identifier rubyid_force_flush'>force_flush</span> <span class='kw'>if</span> <span class='ivar'>@exporter</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:force_flush</span><span class='rparen'>)</span>
  <span class='ivar'>@exporter</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span>
  <span class='const'><span class='object_link'><a href="../Export.html" title="OpenTelemetry::SDK::Metrics::Export (module)">Export</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Export.html#SUCCESS-constant" title="OpenTelemetry::SDK::Metrics::Export::SUCCESS (constant)">SUCCESS</a></span></span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'><span class='object_link'><a href="../../../../OpenTelemetry.html" title="OpenTelemetry (module)">OpenTelemetry</a></span></span><span class='period'>.</span><span class='id identifier rubyid_handle_error'>handle_error</span><span class='lparen'>(</span><span class='label'>exception:</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Fail to shutdown PeriodicMetricReader.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../Export.html" title="OpenTelemetry::SDK::Metrics::Export (module)">Export</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Export.html#FAILURE-constant" title="OpenTelemetry::SDK::Metrics::Export::FAILURE (constant)">FAILURE</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Aug 14 17:38:53 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.1.6).
</div>

    </div>
  </body>
</html>